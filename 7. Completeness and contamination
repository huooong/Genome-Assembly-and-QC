###################################
#!/bin/bash

# Directories
INPUT_DIR="Data"
OUTPUT_DIR="Results"
RACON_DIR="$OUTPUT_DIR/Racon"
MEDAKA_DIR="$OUTPUT_DIR/Medaka"

# Load conda commands
CONDA_BASE=$(dirname $(dirname $(which conda)))
source "$CONDA_BASE/etc/profile.d/conda.sh"

###################################

# Run CheckM2
echo "---------------------------------------------------"
echo "Assessing completeness and contamination"
echo "---------------------------------------------------"

## Load CheckM2 environment
conda activate checkm2_env

## Directory for CheckM2 
CHECKM2_DIR="$OUTPUT_DIR/CheckM2"
mkdir -p "$CHECKM2_DIR"

## CheckM2 settings
CHECKM2_DB="
THREADS=8

## Run CheckM2
for file in "$INPUT_DIR"/*.fasta; do
    sample=$(basename "$file" .fastq)
    sample_dir="$CHECKM2_DIR/$sample"
    mkdir -p "$sample_dir"

    echo "Running CheckM2 on $sample ....."
    checkm2 predict \
    	-- threads $THREADS \
		-- input "$file" \
		-- output-directory "$sample_dir"
    
    echo 
    
    echo "CheckM2 results for $sample have been saved in $sample_dir"
    echo "---------------------------------------------------"

done
conda deactivate

