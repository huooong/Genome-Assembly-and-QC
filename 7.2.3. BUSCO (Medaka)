#######################################
#!/bin/bash

# Directories 
INPUT_DIR="Data"
OUTPUT_DIR="Results"
MEDAKA_DIR="$OUTPUT_DIR/Medaka"

# Load conda commands
CONDA_BASE=$(dirname $(dirname $(which conda)))
source "$CONDA_BASE/etc/profile.d/conda.sh"

# Parameters
RACON_ROUNDS=3
#######################################

# Assessment of completeness and quality of assembly with BUSCO
echo "---------------------------------------------------"
echo "Assessing completeness and quality of assembly with BUSCO"
echo "---------------------------------------------------"

## Directory for BUSCO
BUSCO_DIR="Results/BUSCO_medaka"
mkdir -p "$BUSCO_DIR"

## Activate BUSCO environment
conda activate busco_env

## BUSCO parameters
LINEAGE="bacteria_odb12"        #change
CPU=16      #change

## Run BUSCO 
for assembly in "$MEDAKA_DIR"/*/*.fasta; do
    # Skip if no files found
    [ -e "$assembly" ] || continue

    sample=$(basename "$(dirname "$assembly")")
    sample_dir="$BUSCO_DIR/$sample"
    mkdir -p "$sample_dir"

    echo "Running BUSCO on $sample"

    busco \
        -i "$assembly" \
        -l "$LINEAGE" \
        -m genome \
        -c "$CPU" \
        --out_path "$sample_dir" 

    echo "Finished $sample" 
    echo "---------------------------------------------------"

done
conda deactivate



