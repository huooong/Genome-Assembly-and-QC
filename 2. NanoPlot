###################################
#!/bin/bash

# Directories
INPUT_DIR="Data"
OUTPUT_DIR="Results"

# Load conda commands
CONDA_BASE=$(dirname $(dirname $(which conda)))
source "$CONDA_BASE/etc/profile.d/conda.sh"

###################################

# Run NanoPlot
echo "---------------------------------------------------"
echo "STEP 2: Assessing quality with NanoPlot"
echo "---------------------------------------------------"

##Load NanoPlot environment
conda activate nanoplot2

##Create directory for NanoPlot Results
NANOPLOT_DIR="$OUTPUT_DIR/NanoPlot"
mkdir -p "$NANOPLOT_DIR"

for file in "$INPUT_DIR"/*.fastq; do
    sample=$(basename "$file" .fastq)
    sample_dir="$NANOPLOT_DIR/$sample"
    mkdir -p "$sample_dir"

    echo "Running NanoPlot on $sample ----------"
    NanoPlot \
        --fastq "$file" \
        -o "$sample_dir" \
        --prefix "$sample" \
        --tsv_stats --raw
done
conda deactivate

echo "---------------------------------------------------"
echo "NanoPlot results have been saved in $NANOPLOT_DIR"
echo "---------------------------------------------------"
